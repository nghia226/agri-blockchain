{% extends 'base.html' %}
{% block content %}
<h2>Chi tiáº¿t sáº£n pháº©m</h2>

{% if product %}

    {% if warning %}
      <div class="alert alert-warning">
        {{ warning }}
      </div>
    {% endif %}

    <p><strong>ID:</strong> {{ product.product_id }}</p>
    <p><strong>TÃªn:</strong> {{ product.name }}</p>
    <p><strong>NÃ´ng dÃ¢n:</strong> {{ product.farmer }}</p>
    <p><strong>Äá»‹a Ä‘iá»ƒm:</strong> {{ product.location }}</p>
    <p><strong>NgÃ y thu hoáº¡ch:</strong> {{ product.harvest_date }}</p>
    <p><strong>Chá»©ng nháº­n:</strong> {{ product.certification }}</p>

    <h5 class="mt-4">ğŸ“œ Lá»‹ch sá»­ chuá»—i cung á»©ng:</h5>
    <ul class="list-group">
      {% for entry in product.timeline %}
        <li class="list-group-item">{{ entry }}</li>
      {% endfor %}
    </ul>

    <!-- Form cáº­p nháº­t bÆ°á»›c -->
    <form method="POST" action="{{ url_for('update_timeline', pid=product.product_id) }}" class="mt-4">
      <div class="row g-2">
        <div class="col-md-6">
          <select name="step" class="form-select" required>
            <option value="" disabled selected>Chá»n bÆ°á»›c tiáº¿p theo</option>
            <option value="pack">ğŸ“¦ ÄÃ³ng gÃ³i</option>
            <option value="ship">ğŸšš Váº­n chuyá»ƒn</option>
            <option value="sell">ğŸ¬ TiÃªu thá»¥</option>
          </select>
        </div>
        <div class="col-md-6">
          <button type="submit" class="btn btn-primary">Cáº­p nháº­t</button>
        </div>
      </div>
    </form>

    <!-- ğŸ“ Upload tÃ i liá»‡u -->
    <h5 class="mt-5">ğŸ“ TÃ i liá»‡u Ä‘Ã­nh kÃ¨m:</h5>
    <form method="POST" action="{{ url_for('upload_document', pid=product.product_id) }}" enctype="multipart/form-data" class="mb-3">
      <div class="row g-2">
        <div class="col-md-9">
          <input type="file" name="file" accept=".pdf" class="form-control" required>
        </div>
        <div class="col-md-3">
          <button class="btn btn-outline-success w-100" type="submit">Táº£i lÃªn</button>
        </div>
      </div>
    </form>

    {% if files %}
    <ul class="list-group">
      {% for filename in files %}
        <li class="list-group-item">
          <a href="{{ url_for('download_document', pid=pid, filename=filename) }}" target="_blank">{{ filename }}</a>
        </li>
      {% endfor %}
    </ul>
    {% else %}
      <p><i>ChÆ°a cÃ³ tÃ i liá»‡u nÃ o Ä‘Æ°á»£c táº£i lÃªn.</i></p>
    {% endif %}

    <!-- ğŸ“± QR Code -->
    <h5 class="mt-5">ğŸ“± MÃ£ QR truy xuáº¥t:</h5>
    {% if qr_code %}
      <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code" class="img-thumbnail" style="max-width: 200px;">
      <p class="text-muted"><small>QuÃ©t Ä‘á»ƒ truy xuáº¥t sáº£n pháº©m nÃ y</small></p>
    {% else %}
      <p><i>KhÃ´ng thá»ƒ táº¡o mÃ£ QR.</i></p>
    {% endif %}

    <a href="{{ url_for('products') }}" class="btn btn-secondary mt-4">â¬… Vá» danh sÃ¡ch</a>

{% else %}
    <p>âŒ KhÃ´ng tÃ¬m tháº¥y sáº£n pháº©m.</p>
{% endif %}
{% endblock %}
